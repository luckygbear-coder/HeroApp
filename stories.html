<script>
  // 🔑 記錄上次看到第幾集的 key
  const STORY_EP_KEY = "bearStoryLastEpisodeV1";

  // 10 集故事資料
  const episodes = [
    {
      id: 1,
      title: "第 1 集：會下星星雨的山谷",
      text: `很久以前，在一個遠遠的山谷裡，每到晚上就會下起「星星雨」。  
星星不是重重地掉下來，而是像羽毛一樣輕輕地飄落在草地上。

熊熊就是在這裡出生的。

他還是小寶寶的時候，就很喜歡抬頭看星星，  
他覺得那些發光的點，像是一個一個在對他眨眼的朋友。

其他小熊喜歡比賽誰跑得快、誰跳得高，  
熊熊卻最喜歡做的事情是——安安靜靜地聽大人說故事。

有的故事勇敢、有的故事難過。  
每當說到心酸的地方，熊熊就會伸出毛茸茸的小熊掌，  
輕輕地拍拍旁邊的朋友，好像在說：  
「沒關係，我在。」`,
      quote: "有時候，一隻安靜陪在你身邊的小熊，就比很多話更有力量。"
    },
    {
      id: 2,
      title: "第 2 集：不會魔法的小熊",
      text: `長大一點之後，熊熊發現一件事情：  
自己好像不太會「厲害的魔法」。

他跑不快，也跳不高。  
別的小熊會在森林裡翻跟斗，他只要跑兩步就會喘。

有時候，他也會偷偷覺得難過：  
「我是不是不夠厲害？」

但是慢慢地，山谷裡的居民發現，  
只要誰心情不好、誰害怕黑夜、誰睡不著，  
第一個想到的，永遠是熊熊。

因為熊熊很會聽。  
他不會急著說『你不要這樣想』，  
而是會認真地、專心地，把對方的心情接住。

原來，這就是熊熊最特別的地方——  
他會的不是大魔法，而是「好好陪在你身邊的小魔法」。`,
      quote: "不是每個人都要會大魔法，有時候，溫柔就是最重要的力量。"
    },
    {
      id: 3,
      title: "第 3 集：遠方來的孩子們",
      text: `有一天，山谷裡來了一群從遠方村莊來的小孩。

他們一開始很安靜，只是坐在河畔，看著水發呆。  
熊熊走過去，拿出自己最喜歡的小點心，慢慢地坐在旁邊。

後來，孩子們開始說話了。

有人說，自己在學校常常擔心考不好；  
有人說，自己覺得好像怎麼努力都比不上別人；  
還有人說：「我常常覺得自己很麻煩。」

熊熊聽完，只是輕輕地說：  
「你知道嗎？在我眼裡，你們都很重要。  
  就算現在覺得辛苦，也不代表你不好。」

那天晚上，星星雨下得特別亮。  
孩子們躺在草地上，看著天空，  
忽然覺得，心裡好像沒有那麼重了。`,
      quote: "當有人願意好好聽你說，心就會慢慢變輕。"
    },
    {
      id: 4,
      title: "第 4 集：熊熊決定當村長",
      text: `從那天起，來到山谷裡的人越來越多。

有迷路的旅人；  
有剛剛吵完架的朋友；  
也有覺得自己不被理解的大人。

熊熊看著大家，心裡想：  
「如果這裡可以變成一個『誰都可以來休息』的地方，一定很好。」

於是，他戴上了一頂有小星星的帽子，  
對大家害羞地宣布：

「那…從今天開始，我就當這裡的村長，好嗎？  
  你們可以叫我——村長熊熊。」

大家拍手、大叫、吹口哨，  
還有人送給他一個小木牌，上面寫著：

「歡迎光臨冒險者天堂。」`,
      quote: "有時候，當你願意站出來照顧別人，你也會一起變得更勇敢。"
    },
    {
      id: 5,
      title: "第 5 集：冒險者天堂開張",
      text: `村長熊熊開始蓋一個小小的村莊。

有可以玩遊戲的廣場，  
有可以說悄悄話的樹下長椅，  
還有一間間溫暖的小屋子。

他為孩子們準備了「小勇者大冒險」的遊戲，  
讓大家用剪刀石頭布跟魔物交朋友，  
學著說出自己的感受，  
也學著理解別人的心情。

每當有小勇者成功安撫了魔物，  
天空就會掉下一顆小星星，  
代表今天又多了一點點勇氣。`,
      quote: "當你願意理解別人的心情，你也在學習擁抱自己的心。"
    },
    {
      id: 6,
      title: "第 6 集：塔羅屋與卜卦小屋",
      text: `除了遊戲廣場以外，  
村長熊熊還蓋了兩間特別的小屋。

一間是「熊熊塔羅屋」，  
房間裡有 22 張會說故事的牌。  
當你坐下來，深呼吸，輕輕抽出三張牌，  
熊熊就會用溫柔的話，  
告訴你牌裡看到的鼓勵與提醒。

另一間是「熊熊易經卜卦小屋」，  
裡面有三枚會叮噹作響的銅錢。  
你把問題放在心裡，靜靜地擲六次，  
古老的卦象就會變成一句句好懂的話，  
陪你一起看清楚現在正在發生什麼事。

熊熊常常說：  
「占卜不是幫你決定，而是陪你一起想。」`,
      quote: "真正的答案，永遠藏在你的心裡，熊熊只是幫你把那盞燈打亮。"
    },
    {
      id: 7,
      title: "第 7 集：魔物們也會難過",
      text: `在冒險者天堂裡，有很多魔物。  
有看起來很兇的獸人、  
有全身是刺的史萊姆、  
也有常常發呆的樹精。

一開始，大家都很怕他們。  
但在一次次的對戰和對話中，小勇者們發現——

原來魔物們不是壞的，  
他們只是被「壞心情」纏住了。

有人因為常常被誤解而生氣；  
有人因為總是被丟下而覺得孤單；  
也有人只是很久很久沒有被好好擁抱。

慢慢地，小勇者們學會對魔物說：  
「你可以生氣，但我還是在這裡。」  
「如果你怕黑，我可以陪你一起等天亮。」

於是，魔物的眼淚變成了閃閃發光的小水珠，  
掉在地上，長出了新的花。`,
      quote: "當你願意看見別人兇巴巴背後的難過，你就已經是一個很棒的勇者了。"
    },
    {
      id: 8,
      title: "第 8 集：村長熊熊的低潮",
      text: `有一天晚上，星星雨沒有下。

熊熊坐在樹下，覺得心裡悶悶的。  
他開始擔心：  
「我真的有幫上忙嗎？」  
「如果有一天大家不需要我了怎麼辦？」

那天，他第一次覺得自己也很累。

這時，小勇者們悄悄地出現了。  
有人帶了自己畫的畫，  
有人寫了一小段話，  
有人只是緊緊抱住他。

「熊熊，你知道嗎？  
  有時候，只要想到『那裡還有一個村長熊熊在等我』，  
  我就會比較不怕了。」

熊熊聽完，眼睛也紅紅的。  
他發現，原來自己也可以被安慰。`,
      quote: "照顧別人的人，也可以有累的時候；敢說出『我也需要陪伴』，是一種新的勇敢。"
    },
    {
      id: 9,
      title: "第 9 集：孩子們寄來的信",
      text: `後來，從很多地方寄來的信越來越多。

有的小朋友畫了一張自己變成小勇者的圖，  
寫著：「我今天鼓起勇氣跟同學道歉了。」  

有的大人偷偷在信裡說：  
「多虧有熊熊的遊戲和占卜，我才能好好跟孩子說話。」  

每一封信，熊熊都小心地折好，  
放進一個叫作「勇氣星星盒」的木箱裡。

只要哪一天他又覺得有點不安，  
就會打開盒子，看看那些真心的文字，  
提醒自己：

「原來，我們都在一起練習變得更溫柔。」`,
      quote: "每一顆願意說出真心的小星星，都讓世界亮一點點。"
    },
    {
      id: 10,
      title: "第 10 集：下一個故事，輪到你來寫",
      text: `現在，你正在讀著這本熊熊故事書。

也許你是孩子，也許你是家長，  
也許你正經歷一點點小小的難過，  
也許你只是剛好路過，想在睡前看一個溫柔的故事。

不管你是誰，村長熊熊都想跟你說：

「謝謝你願意走進這裡。  
  從今天開始，  
  你也可以是那個願意聽別人說話的人，  
  也可以是那個願意抱抱自己的勇者。」

冒險者天堂的故事，還沒有結束。  
因為下一頁，  
就輪到你，  
慢慢地，一點一滴地，  
把自己的故事寫進來。`,
      quote: "世界上沒有完美的勇者，只有願意再試一次的你。"
    }
  ];

  // 讀取上次看到第幾集（index）
  function loadLastEpisodeIndex() {
    try {
      const raw = localStorage.getItem(STORY_EP_KEY);
      if (!raw) return 0;
      const idx = parseInt(raw, 10);
      if (isNaN(idx)) return 0;
      if (idx < 0 || idx >= episodes.length) return 0;
      return idx;
    } catch (e) {
      return 0;
    }
  }

  // 儲存目前看到第幾集（index）
  function saveLastEpisodeIndex(idx) {
    try {
      localStorage.setItem(STORY_EP_KEY, String(idx));
    } catch (e) {
      // 靜靜失敗沒關係
    }
  }

  let currentIndex = loadLastEpisodeIndex();

  const episodeBar   = document.getElementById("episodeBar");
  const titleEl      = document.getElementById("episodeTitle");
  const textEl       = document.getElementById("episodeText");
  const quoteEl      = document.getElementById("episodeQuote");
  const illuEl       = document.getElementById("storyIllustration");
  const prevBtn      = document.getElementById("prevEpBtn");
  const nextBtn      = document.getElementById("nextEpBtn");

  function renderEpisodeButtons() {
    episodeBar.innerHTML = "";
    episodes.forEach((ep, idx) => {
      const btn = document.createElement("button");
      btn.className = "episode-btn" + (idx === currentIndex ? " active" : "");
      btn.textContent = ep.id + " 集";
      btn.addEventListener("click", () => {
        currentIndex = idx;
        renderEpisode();
      });
      episodeBar.appendChild(btn);
    });
  }

  function renderEpisode() {
    const ep = episodes[currentIndex];
    titleEl.textContent = ep.title;
    textEl.textContent  = ep.text;
    quoteEl.textContent = ep.quote;

    illuEl.textContent =
      `未來插圖位置：第 ${ep.id} 集〈${ep.title.replace(/^第 \\d+ 集：/, "")}〉的圖片會放在這裡。`;

    // 🌙 每次切換集數就記住這一集
    saveLastEpisodeIndex(currentIndex);

    // 更新按鈕狀態
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === episodes.length - 1;

    // 更新上方集數按鈕樣式
    const buttons = episodeBar.querySelectorAll(".episode-btn");
    buttons.forEach((b, idx) => {
      if (idx === currentIndex) b.classList.add("active");
      else b.classList.remove("active");
    });

    // 捲動到頁面上方，方便床邊閱讀從頭開始看
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  prevBtn.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      renderEpisode();
    }
  });

  nextBtn.addEventListener("click", () => {
    if (currentIndex < episodes.length - 1) {
      currentIndex++;
      renderEpisode();
    }
  });

  // 初始化
  renderEpisodeButtons();
  renderEpisode();
</script>