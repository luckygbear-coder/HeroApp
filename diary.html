<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç†Šç†Šå†’éšªæ—¥è¨˜ ï½œ å†’éšªè€…å¤©å ‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .diary-wrap {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px 40px;
      color: #4a3450;
    }

    .diary-card {
      background: rgba(255,247,230,0.96);
      border-radius: 20px;
      border: 2px solid #f7dba5;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      padding: 18px 16px;
      margin-bottom: 16px;
    }

    .diary-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .diary-title-row h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: .12em;
    }

    .diary-title-row span.emoji {
      font-size: 26px;
    }

    .diary-subtitle {
      font-size: 12px;
      color: #91667f;
      margin-bottom: 6px;
    }

    h2.section-title {
      margin: 10px 0 6px;
      font-size: 15px;
      color: #7c5c88;
    }

    .entry-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .entry {
      background: #fffdf8;
      border-radius: 12px;
      border: 1px solid #f2d7b1;
      padding: 8px 10px;
      font-size: 12px;
      line-height: 1.6;
    }

    .entry-top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
      color: #a67b5b;
    }

    .entry-type {
      font-weight: 600;
      font-size: 11px;
    }

    .entry-time {
      font-size: 11px;
    }

    .entry-text {
      white-space: pre-line;
      color: #5a3844;
    }

    .entry-tags {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .entry-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #e4bfd2;
      background: #fff4fb;
      color: #8b5675;
    }

    .no-data {
      font-size: 12px;
      color: #a87f7f;
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }

    .btn-row a {
      flex: 1;
      text-align: center;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 13px;
      text-decoration: none;
      border: 1px solid #e8c9b2;
      background: #fff7ef;
      color: #7c5261;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .back-btn {
      margin-top: 4px;
    }
  </style>
</head>
<body class="page-wrap">

<div class="diary-wrap">

  <div class="diary-card">
    <div class="diary-title-row">
      <span class="emoji">ğŸ““</span>
      <h1>ç†Šç†Šå†’éšªæ—¥è¨˜</h1>
    </div>
    <div class="diary-subtitle">
      æŠŠèªéŒ„ã€å åœã€å¦è±¡çš„ä¸€é»ä¸€æ»´ï¼Œæ”¶é›†æˆä½ çš„å†’éšªç´€éŒ„ç°¿ã€‚  
      æœ‰ç©ºæ™‚ï¼Œå¯ä»¥å›ä¾†çœ‹çœ‹è‡ªå·±ä¸€è·¯èµ°äº†å¤šé ã€‚ğŸ»
    </div>

    <div class="btn-row">
      <a href="index.html" class="back-btn">ğŸ  å›å†’éšªè€…å¤©å ‚</a>
      <a href="quotes.html">ğŸ“œ å»æŠ½ä¸€å¥æ–°èªéŒ„</a>
    </div>
  </div>

  <!-- èªéŒ„ç´€éŒ„ -->
  <div class="diary-card">
    <h2 class="section-title">ğŸ“œ ç†Šç†ŠèªéŒ„ç´€éŒ„</h2>
    <div id="quoteList" class="entry-list">
      <div class="no-data">ç›®å‰é‚„æ²’æœ‰èªéŒ„ç´€éŒ„ï¼Œå¯ä»¥å»ã€Œç†Šç†ŠèªéŒ„å°å±‹ã€æŠ½ä¸€å¥è©¦è©¦çœ‹ï½</div>
    </div>
  </div>

  <!-- å¡”ç¾…ç´€éŒ„ï¼ˆé ç•™ï¼‰ -->
  <div class="diary-card">
    <h2 class="section-title">ğŸ”® ç†Šç†Šå¡”ç¾…ç´€éŒ„</h2>
    <div id="tarotList" class="entry-list">
      <div class="no-data">
        ç›®å‰å¡”ç¾…æ˜¯åœ¨å¦ä¸€å€‹ç¶²ç«™åŸ·è¡Œï¼ˆä¸åŒç¶²å€ï¼‰ï¼Œ  
        ç€è¦½å™¨ä¸æœƒåˆ†äº«ç´€éŒ„ã€‚  
        ä¹‹å¾Œå¦‚æœä½ æŠŠå¡”ç¾…é æ¬åˆ°åŒä¸€å€‹å°ˆæ¡ˆï¼Œæˆ‘å·²ç¶“å¹«ä½ é ç•™å¥½å€å¡Šï¼Œåˆ°æ™‚å°±èƒ½ä¸€èµ·é¡¯ç¤ºå›‰ã€‚âœ¨
      </div>
    </div>
  </div>

<!-- ğŸ§¿ ç†Šç†Šæ˜“ç¶“ç´€éŒ„ -->
<div class="card adventure-card">
  <div class="card-title">
    <span>ğŸ§¿ ç†Šç†Šæ˜“ç¶“ç´€éŒ„</span>
  </div>
  <div id="ichingList" class="adventure-list"></div>
</div>

<script>
  const ADVENTURE_DIARY_KEY = "bearAdventureDiaryV1";

  function loadAdventureDiary() {
    try {
      const raw = localStorage.getItem(ADVENTURE_DIARY_KEY);
      const parsed = JSON.parse(raw || "[]");
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      console.warn("è®€å–å†’éšªæ—¥è¨˜å¤±æ•—", e);
      return [];
    }
  }

  function renderIchingList() {
    const listEl = document.getElementById("ichingList");
    if (!listEl) return;

    listEl.innerHTML = "";

    const all = loadAdventureDiary();
    const ichingList = all.filter((item) => item.type === "iching");

    if (ichingList.length === 0) {
      const empty = document.createElement("div");
      empty.textContent =
        "ç›®å‰é‚„æ²’æœ‰æ˜“ç¶“ç´€éŒ„ã€‚å¦‚æœä½ åœ¨ç†Šç†Šæ˜“ç¶“å°å±‹åœéå¦ï¼Œè€Œä¸”è·Ÿæœ¬ç¶²ç«™æ˜¯åŒä¸€å€‹ç¶²å€ï¼Œé€™è£¡å°±æœƒè‡ªå‹•é¡¯ç¤ºç´€éŒ„ã€‚";
      empty.style.fontSize = "0.85rem";
      empty.style.color = "#8a6b7a";
      listEl.appendChild(empty);
      return;
    }

    ichingList.forEach((item) => {
      const box = document.createElement("div");
      box.className = "adventure-item";

      const title = document.createElement("div");
      title.className = "adventure-item-title";
      title.textContent = item.title || "ç†Šç†Šæ˜“ç¶“åœå¦";

      const time = document.createElement("div");
      time.className = "adventure-item-time";
      time.textContent = item.time || "";

      const content = document.createElement("div");
      content.className = "adventure-item-content";
      content.textContent =
        (item.hexName ? "å¦è±¡ï¼šã€Œ" + item.hexName + "ã€\n" : "") +
        (item.shortMeaning || "") +
        (item.trend ? "ï¼ˆæ•´é«”èµ°å‘ï¼š" + item.trend + "ï¼‰" : "");

      const note = document.createElement("div");
      note.className = "adventure-item-note";
      note.textContent = item.note || "";

      box.appendChild(title);
      box.appendChild(time);
      box.appendChild(content);
      if (item.note) box.appendChild(note);

      listEl.appendChild(box);
    });
  }

  document.addEventListener("DOMContentLoaded", renderIchingList);
</script>
  // ========= å…±ç”¨ï¼šè®€å– localStorage =========
  function loadArray(key) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      console.warn("è®€å–å¤±æ•—", key, e);
      return [];
    }
  }

  // ========= å†’éšªæ—¥è¨˜ç¸½è¡¨ =========
  const ADVENTURE_DIARY_KEY = "bearAdventureDiaryV1";
  let adventureDiary = loadArray(ADVENTURE_DIARY_KEY);

  // èˆŠç‰ˆå„è‡ªçš„ç´€éŒ„ï¼ˆçµ¦é‚„æ²’å®Œå…¨ä¸²å¥½çš„ç‹€æ³ç”¨ï¼Œç•¶ä½œå‚™æ´ï¼‰
  const legacyQuoteHistory = loadArray("bearQuoteHistoryV1");
  const legacyTarotHistory = loadArray("bearTarotHistoryV1");
  const legacyIchingHistory = loadArray("bearHexHistoryV1");

  // ========= æ¸²æŸ“å·¥å…· =========
  function renderList(listEl, data, typeLabel) {
    if (!data.length) return; // æ²’è³‡æ–™å°±ä¿ç•™åŸæœ¬ã€Œno-dataã€æ–‡å­—

    listEl.innerHTML = data
      .map(item => `
        <div class="entry">
          <div class="entry-top">
            <div class="entry-type">${typeLabel}</div>
            <div class="entry-time">${item.time || ""}</div>
          </div>
          <div class="entry-text">${(item.text || "").replace(/\n/g,"<br>")}</div>
          ${
            item.tags && item.tags.length
              ? `<div class="entry-tags">
                   ${item.tags.map(t => `<span class="entry-tag">${t}</span>`).join("")}
                 </div>`
              : ""
          }
        </div>
      `)
      .join("");
  }

  // ========= DOM =========
  const quoteListEl  = document.getElementById("quoteList");
  const tarotListEl  = document.getElementById("tarotList");
  const ichingListEl = document.getElementById("ichingList");

  // ========= ä¾ type åˆ†é¡ =========
  const diaryQuotes = adventureDiary.filter(item => item.type === "quote");
  const diaryTarot  = adventureDiary.filter(item => item.type === "tarot");
  const diaryIching = adventureDiary.filter(item => item.type === "iching");

  // ğŸ“ èªéŒ„ï¼šå„ªå…ˆç”¨å†’éšªæ—¥è¨˜ï¼Œæ²’æœ‰å°±ç”¨èˆŠçš„ bearQuoteHistoryV1
  if (diaryQuotes.length) {
    renderList(quoteListEl, diaryQuotes, "ç†Šç†ŠèªéŒ„");
  } else if (legacyQuoteHistory.length) {
    renderList(quoteListEl, legacyQuoteHistory, "ç†Šç†ŠèªéŒ„");
  }

  // ğŸ”® å¡”ç¾…ï¼šç­‰ä½ ä¹‹å¾ŒæŠŠå¡”ç¾…ä¹Ÿå¯«é€² adventureDiaryï¼Œå°±æœƒè‡ªå‹•é¡¯ç¤º
  if (diaryTarot.length) {
    renderList(tarotListEl, diaryTarot, "ç†Šç†Šå¡”ç¾…å åœ");
  } else if (legacyTarotHistory.length) {
    renderList(tarotListEl, legacyTarotHistory, "ç†Šç†Šå¡”ç¾…å åœ");
  }

  // ğŸ§¿ æ˜“ç¶“ï¼šåŒä¸Š
  if (diaryIching.length) {
    renderList(ichingListEl, diaryIching, "ç†Šç†Šæ˜“ç¶“åœå¦");
  } else if (legacyIchingHistory.length) {
    renderList(ichingListEl, legacyIchingHistory, "ç†Šç†Šæ˜“ç¶“åœå¦");
  }
<script>
  (function () {
    const ADVENTURE_DIARY_KEY = "bearAdventureDiaryV1";

    function loadAdventureDiary() {
      try {
        const raw = localStorage.getItem(ADVENTURE_DIARY_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.warn("è®€å–å†’éšªæ—¥è¨˜å¤±æ•—", e);
        return [];
      }
    }

    const listEl = document.getElementById("ichingList");
    if (!listEl) return;

    const diary = loadAdventureDiary().filter(e => e.type === "iching");

    if (!diary.length) {
      listEl.innerHTML =
        '<li class="diary-empty">ç›®å‰é‚„æ²’æœ‰æ˜“ç¶“ç´€éŒ„ï½å…ˆå»ã€Œç†Šç†Šæ˜“ç¶“åœå¦ã€æŠ½ä¸€å¦å§ ğŸŒ±</li>';
      return;
    }

    listEl.innerHTML = diary
      .map(entry => `
        <li class="diary-item">
          <div class="diary-header">
            <span class="diary-title">${entry.title || "ç†Šç†Šæ˜“ç¶“ç´€éŒ„"}</span>
            <span class="diary-time">${entry.time || ""}</span>
          </div>
          <div class="diary-body">
            ${entry.topic ? `<div>ä¸»é¡Œï¼š${entry.topic}</div>` : ""}
            ${entry.hexName ? `<div>å¦è±¡ï¼š${entry.hexName}</div>` : ""}
            ${entry.shortMeaning ? `<div>${entry.shortMeaning}</div>` : ""}
            ${entry.note ? `<div class="diary-note">ğŸ» ç†Šç†Šèªªï¼š${entry.note}</div>` : ""}
          </div>
        </li>
      `)
      .join("");
  })();
</script>

</body>
</html>
