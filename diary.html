<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç†Šç†Šå†’éšªæ—¥è¨˜ ï½œ å†’éšªè€…å¤©å ‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .diary-wrap {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px 40px;
      color: #4a3450;
    }

    .diary-card {
      background: rgba(255,247,230,0.96);
      border-radius: 20px;
      border: 2px solid #f7dba5;
      box-shadow: 0 4px 14px rgba(0,0,0,0.25);
      padding: 18px 16px;
      margin-bottom: 16px;
    }

    .diary-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .diary-title-row h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: .12em;
    }

    .diary-title-row span.emoji {
      font-size: 26px;
    }

    .diary-subtitle {
      font-size: 12px;
      color: #91667f;
      margin-bottom: 6px;
    }

    h2.section-title {
      margin: 10px 0 6px;
      font-size: 15px;
      color: #7c5c88;
    }

    .entry-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .entry {
      background: #fffdf8;
      border-radius: 12px;
      border: 1px solid #f2d7b1;
      padding: 8px 10px;
      font-size: 12px;
      line-height: 1.6;
    }

    .entry-top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
      color: #a67b5b;
    }

    .entry-type {
      font-weight: 600;
      font-size: 11px;
    }

    .entry-time {
      font-size: 11px;
    }

    .entry-text {
      white-space: pre-line;
      color: #5a3844;
    }

    .entry-tags {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .entry-tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #e4bfd2;
      background: #fff4fb;
      color: #8b5675;
    }

    .no-data {
      font-size: 12px;
      color: #a87f7f;
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }

    .btn-row a {
      flex: 1;
      text-align: center;
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 13px;
      text-decoration: none;
      border: 1px solid #e8c9b2;
      background: #fff7ef;
      color: #7c5261;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .back-btn {
      margin-top: 4px;
    }
  </style>
</head>
<body class="page-wrap">

<div class="diary-wrap">

  <!-- å°é¢å¡ -->
  <div class="diary-card">
    <div class="diary-title-row">
      <span class="emoji">ğŸ““</span>
      <h1>ç†Šç†Šå†’éšªæ—¥è¨˜</h1>
    </div>
    <div class="diary-subtitle">
      æŠŠèªéŒ„ã€å åœã€å¦è±¡çš„ä¸€é»ä¸€æ»´ï¼Œæ”¶é›†æˆä½ çš„å†’éšªç´€éŒ„ç°¿ã€‚  
      æœ‰ç©ºæ™‚ï¼Œå¯ä»¥å›ä¾†çœ‹çœ‹è‡ªå·±ä¸€è·¯èµ°äº†å¤šé ã€‚ğŸ»
    </div>

    <div class="btn-row">
      <a href="index.html" class="back-btn">ğŸ  å›å†’éšªè€…å¤©å ‚</a>
      <a href="quotes.html">ğŸ“œ å»æŠ½ä¸€å¥æ–°èªéŒ„</a>
    </div>
  </div>

  <!-- èªéŒ„ç´€éŒ„ -->
  <div class="diary-card">
    <h2 class="section-title">ğŸ“œ ç†Šç†ŠèªéŒ„ç´€éŒ„</h2>
    <div id="quoteList" class="entry-list">
      <div class="no-data">
        ç›®å‰é‚„æ²’æœ‰èªéŒ„ç´€éŒ„ï¼Œå¯ä»¥å»ã€Œç†Šç†ŠèªéŒ„å°å±‹ã€æŠ½ä¸€å¥è©¦è©¦çœ‹ï½
      </div>
    </div>
  </div>

  <!-- å¡”ç¾…ç´€éŒ„ -->
  <div class="diary-card">
    <h2 class="section-title">ğŸ”® ç†Šç†Šå¡”ç¾…ç´€éŒ„</h2>
    <div id="tarotList" class="entry-list">
      <div class="no-data">
        ç›®å‰å¡”ç¾…æ˜¯åœ¨å¦ä¸€å€‹ç¶²ç«™åŸ·è¡Œï¼ˆä¸åŒç¶²å€ï¼‰ï¼Œç€è¦½å™¨ä¸æœƒåˆ†äº«ç´€éŒ„ã€‚  
        ä¹‹å¾Œå¦‚æœä½ æŠŠå¡”ç¾…é æ¬åˆ°åŒä¸€å€‹å°ˆæ¡ˆï¼Œæˆ‘å·²ç¶“å¹«ä½ é ç•™å¥½å€å¡Šï¼Œåˆ°æ™‚å°±èƒ½ä¸€èµ·é¡¯ç¤ºå›‰ã€‚âœ¨
      </div>
    </div>
  </div>

  <!-- æ˜“ç¶“ç´€éŒ„ -->
  <div class="diary-card">
    <h2 class="section-title">ğŸ§¿ ç†Šç†Šæ˜“ç¶“ç´€éŒ„</h2>
    <div id="ichingList" class="entry-list">
      <div class="no-data">
        ç›®å‰é‚„æ²’æœ‰æ˜“ç¶“ç´€éŒ„ã€‚å¦‚æœä½ åœ¨ã€Œç†Šç†Šæ˜“ç¶“åœå¦ã€åœéå¦ï¼Œ
        ä¸”ç¶²å€æ˜¯åŒä¸€å€‹ <code>luckygbear-coder.github.io</code>ï¼Œé€™è£¡å°±æœƒè‡ªå‹•é¡¯ç¤ºç´€éŒ„ã€‚ğŸ“–
      </div>
    </div>
  </div>

</div>

<script>
  // ===== å…±ç”¨ï¼šè®€å– localStorage é™£åˆ— =====
  function loadArray(key) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      console.warn("è®€å–å¤±æ•—", key, e);
      return [];
    }
  }

  // å…±ç”¨å†’éšªæ—¥è¨˜ keyï¼ˆèªéŒ„ / å¡”ç¾… / æ˜“ç¶“éƒ½æœƒå¯«é€²ä¾†ï¼‰
  const ADVENTURE_DIARY_KEY = "bearAdventureDiaryV1";

  // ===== ä¸€èˆ¬åˆ—è¡¨æ¸²æŸ“ï¼ˆçµ¦èªéŒ„ / èˆŠç‰ˆå¡”ç¾… / èˆŠç‰ˆæ˜“ç¶“ç”¨ï¼‰ =====
  function renderList(listEl, data, typeLabel) {
    if (!listEl) return;
    if (!data.length) return; // ç•™ä¸‹åŸæœ¬ no-data æ–‡å­—

    listEl.innerHTML = data
      .map(item => `
        <div class="entry">
          <div class="entry-top">
            <div class="entry-type">${typeLabel}</div>
            <div class="entry-time">${item.time || ""}</div>
          </div>
          <div class="entry-text">${(item.text || "").replace(/\n/g,"<br>")}</div>
          ${
            item.tags && item.tags.length
              ? `<div class="entry-tags">
                   ${item.tags.map(t => `<span class="entry-tag">${t}</span>`).join("")}
                 </div>`
              : ""
          }
        </div>
      `)
      .join("");
  }

  // ===== æ˜“ç¶“å°ˆç”¨ï¼šä¸»é¡Œæ–‡å­— =====
  function ichingTopicLabel(topic) {
    switch (topic) {
      case "love":   return "æ„Ÿæƒ… / é—œä¿‚";
      case "career": return "å·¥ä½œ / äº‹æ¥­";
      case "wealth": return "è²¡é‹ / é‡‘éŒ¢";
      case "health": return "å¥åº· / èº«å¿ƒ";
      case "social": return "äººéš› / åˆä½œ";
      default:       return "æ•´é«”ç‹€æ³";
    }
  }

  // ===== æ˜“ç¶“å°ˆç”¨æ¸²æŸ“ï¼ˆè®€ bearAdventureDiaryV1 çš„ type="iching"ï¼‰ =====
  function renderIchingDiary(listEl, data) {
    if (!listEl) return;

    if (!data || !data.length) {
      // æ²’è³‡æ–™å°±ä¿ç•™ HTML è£¡åŸæœ¬çš„ no-data æ–‡å­—
      return;
    }

    listEl.innerHTML = data
      .map(item => {
        const tags = [];
        if (item.topic) {
          tags.push("ä¸»é¡Œï¼š" + ichingTopicLabel(item.topic));
        }
        if (item.trend) {
          tags.push("èµ°å‘ï¼š" + item.trend);
        }
        return `
          <div class="entry">
            <div class="entry-top">
              <div class="entry-type">${item.title || "ç†Šç†Šæ˜“ç¶“åœå¦"}</div>
              <div class="entry-time">${item.time || ""}</div>
            </div>
            <div class="entry-text">
              ${
                item.hexName
                  ? "å¦è±¡ï¼šã€Œ" + item.hexName + "ã€\n"
                  : ""
              }${
                item.shortMeaning || ""
              }${
                item.note
                  ? "\n\nğŸ» ç†Šç†Šèªªï¼š\n" + item.note
                  : ""
              }
            </div>
            ${
              tags.length
                ? `<div class="entry-tags">
                     ${tags.map(t => `<span class="entry-tag">${t}</span>`).join("")}
                   </div>`
                : ""
            }
          </div>
        `;
      })
      .join("");
  }

  // ===== DOM Ready =====
  document.addEventListener("DOMContentLoaded", function () {
    const quoteListEl  = document.getElementById("quoteList");
    const tarotListEl  = document.getElementById("tarotList");
    const ichingListEl = document.getElementById("ichingList");

    // å†’éšªæ—¥è¨˜ç¸½è¡¨ï¼ˆæ–°ç‰ˆèªéŒ„ / å¡”ç¾… / æ˜“ç¶“éƒ½æœƒå¯«é€²ä¾†ï¼‰
    const adventureDiary = loadArray(ADVENTURE_DIARY_KEY);

    // èˆŠç‰ˆå„è‡ªçš„ç´€éŒ„ï¼ˆé‚„æ²’å®Œå…¨ä¸²å¥½æ™‚ç•¶å‚™æ´ç”¨ï¼‰
    const legacyQuoteHistory  = loadArray("bearQuoteHistoryV1");
    const legacyTarotHistory  = loadArray("bearTarotHistoryV1");
    const legacyIchingHistory = loadArray("bearHexHistoryV1");

    // ä¾ type åˆ†é¡
    const diaryQuotes = adventureDiary.filter(item => item.type === "quote");
    const diaryTarot  = adventureDiary.filter(item => item.type === "tarot");
    const diaryIching = adventureDiary.filter(item => item.type === "iching");

    // ğŸ“œ èªéŒ„ï¼šå„ªå…ˆç”¨å†’éšªæ—¥è¨˜ï¼Œæ²’æœ‰å°±ç”¨èˆŠçš„ bearQuoteHistoryV1
    if (diaryQuotes.length) {
      renderList(quoteListEl, diaryQuotes, "ç†Šç†ŠèªéŒ„");
    } else if (legacyQuoteHistory.length) {
      renderList(quoteListEl, legacyQuoteHistory, "ç†Šç†ŠèªéŒ„");
    }

    // ğŸ”® å¡”ç¾…ï¼šç­‰ä¹‹å¾Œä½ æŠŠå¡”ç¾…ä¹Ÿå¯«é€² adventureDiaryï¼Œå°±æœƒè‡ªå‹•é¡¯ç¤º
    if (diaryTarot.length) {
      renderList(tarotListEl, diaryTarot, "ç†Šç†Šå¡”ç¾…å åœ");
    } else if (legacyTarotHistory.length) {
      renderList(tarotListEl, legacyTarotHistory, "ç†Šç†Šå¡”ç¾…å åœ");
    }

    // ğŸ§¿ æ˜“ç¶“ï¼šæ–°ç‰ˆç”¨ adventureDiary çš„ type="iching"ï¼ŒèˆŠç‰ˆæ‰ç”¨ bearHexHistoryV1
    if (diaryIching.length) {
      renderIchingDiary(ichingListEl, diaryIching);
    } else if (legacyIchingHistory.length) {
      // èˆŠç‰ˆè³‡æ–™æ ¼å¼è·ŸèªéŒ„é¡ä¼¼ï¼Œå°±ç”¨ä¸€èˆ¬ renderList é¡¯ç¤º
      renderList(ichingListEl, legacyIchingHistory, "ç†Šç†Šæ˜“ç¶“åœå¦");
    }
  });
</script>

</body>
</html>